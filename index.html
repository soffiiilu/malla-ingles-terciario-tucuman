<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Malla Interactiva - Profesorado de Inglés</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fdeef4;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    h1 {
      margin-bottom: 10px;
      color: #c2185b;
    }

    .año {
      margin: 30px 0;
    }

    .titulo-año {
      font-size: 24px;
      margin-bottom: 10px;
      color: #880e4f;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      justify-items: center;
    }

    .materia {
      background-color: white;
      border: 2px solid #c2185b;
      padding: 15px;
      border-radius: 10px;
      width: 100%;
      max-width: 200px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s, border 0.3s;
      position: relative;
    }

    .materia.aprobada {
      background-color: #ec407a;
      color: white;
      border-color: #ec407a;
    }

    .materia.bloqueada {
      background-color: #999;
      color: #eee;
      border-color: #777;
      cursor: not-allowed;
    }

    .tooltip {
      visibility: hidden;
      background-color: black;
      color: #fff;
      text-align: center;
      border-radius: 5px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: -30px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
    }

    .materia:hover .tooltip {
      visibility: visible;
    }

    #contador {
      margin-top: 40px;
      font-size: 20px;
      font-weight: bold;
      color: #6a1b9a;
    }
  </style>
</head>
<body>
  <h1>Malla Interactiva - Profesorado de Inglés</h1>
  <div id="contenedor-materias"></div>
  <div id="contador">0% completado</div>

  <script>
    const materiasData = [
      // [ID, Nombre, Correlativas (array de ID)]
      [1, "Gramática Inglesa I", []],
      [2, "Fonética y Fonología Inglesa I", []],
      [3, "Prácticas Discursivas en Inglés I", []],
      [4, "Gramática Inglesa II", [1]],
      [5, "Fonética y Fonología Inglesa II", [2]],
      [6, "Prácticas Discursivas en Inglés II", [1,2,3]],
      [7, "Estudios Socioculturales y Literarios I", [3]],
      [8, "Gramática Inglesa III", [4]],
      [9, "Fonética y Fonología Inglesa III", [5]],
      [10, "Prácticas Discursivas en Inglés III", [4,5,6]],
      [11, "Literatura Infantil y Juvenil", [6]],
      [12, "Estudios Socioculturales y Literarios II", [6,7]],
      [13, "Lingüística I", [4]],
      [14, "Didáctica del Inglés I", []],
      [15, "Didáctica del Inglés II", [6,14]],
      [16, "Didáctica del Inglés III", [10,15]],
      [17, "Lingüística II", [13,10]],
      [18, "Literatura Anglófona", [10,11]],
      [19, "Estudios Socioculturales y Literarios III", [12]],
      [20, "Prácticas Discursivas en Inglés IV", [10]],
      [21, "Práctica Profesional I", []],
      [22, "Práctica Profesional II", [21]],
      [23, "Práctica Profesional III", [22]],
      [24, "Práctica Profesional IV y Residencia", [23]],
    ];

    const contenedor = document.getElementById("contenedor-materias");
    const contador = document.getElementById("contador");

    const progresoGuardado = JSON.parse(localStorage.getItem('materiasAprobadas')) || [];

    function crearBloques() {
      const años = {
        '1° Año': [1,2,3,21],
        '2° Año': [4,5,6,7,14,22],
        '3° Año': [8,9,10,11,12,13,15,23],
        '4° Año': [16,17,18,19,20,24]
      };

      for (let [titulo, ids] of Object.entries(años)) {
        const añoDiv = document.createElement('div');
        añoDiv.className = 'año';
        añoDiv.innerHTML = `<div class="titulo-año">${titulo}</div><div class="grid"></div>`;
        const grid = añoDiv.querySelector('.grid');

        ids.forEach(id => {
          const [_, nombre, correlativas] = materiasData.find(m => m[0] == id);
          const div = document.createElement('div');
          div.className = 'materia';
          div.dataset.id = id;
          div.dataset.correlativas = correlativas.join(',');
          div.innerHTML = nombre;

          if (correlativas.length > 0) {
            const nombres = correlativas.map(cid => materiasData.find(m => m[0] == cid)[1]);
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = `Requiere: ${nombres.join(', ')}`;
            div.appendChild(tooltip);
          }

          if (progresoGuardado.includes(id.toString())) {
            div.classList.add('aprobada');
          }

          grid.appendChild(div);
        });

        contenedor.appendChild(añoDiv);
      }
    }

    function actualizarBloqueadas() {
      const materias = document.querySelectorAll('.materia');
      materias.forEach(materia => {
        const correlativas = materia.dataset.correlativas;
        if (!correlativas) return;

        const necesarias = correlativas.split(',').filter(x => x);
        const aprobadas = Array.from(document.querySelectorAll('.materia.aprobada')).map(m => m.dataset.id);
        const faltan = necesarias.filter(n => !aprobadas.includes(n));

        if (faltan.length > 0) {
          materia.classList.add('bloqueada');
        } else {
          materia.classList.remove('bloqueada');
        }
      });
    }

    function actualizarContador() {
      const total = document.querySelectorAll('.materia').length;
      const aprobadas = document.querySelectorAll('.materia.aprobada').length;
      const porcentaje = Math.round((aprobadas / total) * 100);
      contador.textContent = `${porcentaje}% completado`;
    }

    function activarClicks() {
      document.querySelectorAll('.materia').forEach(materia => {
        materia.addEventListener('click', () => {
          if (materia.classList.contains('bloqueada')) return;
          materia.classList.toggle('aprobada');

          const nuevasAprobadas = Array.from(document.querySelectorAll('.materia.aprobada')).map(m => m.dataset.id);
          localStorage.setItem('materiasAprobadas', JSON.stringify(nuevasAprobadas));

          actualizarBloqueadas();
          actualizarContador();
        });
      });
    }

    crearBloques();
    actualizarBloqueadas();
    actualizarContador();
    activarClicks();
  </script>
</body>
</html>
